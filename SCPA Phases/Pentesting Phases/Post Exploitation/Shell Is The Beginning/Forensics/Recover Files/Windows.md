# Windows

## 01 - PowerForensics

```powershell
PS C:\> Invoke-WebRequest https://github.com/Invoke-IR/PowerForensics/releases/download/1.1.1/PowerForensics.zip -OutFile powerforensics.zip

PS C:\> Expand-Archive .\powerforensics.zip

PS C:\> cd PowerForensics

PS C:\PowerForensics> Import-Module .\PowerForensicsv2.psd1

PS C:\PowerForensics> Get-ForensicFileRecord | Where { $_.Deleted -eq $true } | Select-Object FullName

PS C:\PowerForensics> $file = Get-ForensicFileRecord | Where { $_.FullName -eq "C:\passwords.txt" }

PS C:\PowerForensics> $file.CopyFile("recovered.txt")
```

## 02 - Metasploit

- **MSF Windows Gather Physical Drives and Logical Volumes Post Module**

```
msf > use post/windows/gather/forensics/enum_drives

msf post(windows/gather/forensics/enum_drives) > options

Module options (post/windows/gather/forensics/enum_drives):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   MAXDRIVES  10               no        Maximum physical drive number
   SESSION                     yes       The session to run this module on
  
  
View the full module info with the info, or info -d command.

msf post(windows/gather/forensics/enum_drives) > set session <session_id>

msf post(windows/gather/forensics/enum_drives) > run
```

- **MSF Windows Gather Deleted Files Enumeration and Recovering Post Module**

```
msf > use post/windows/gather/forensics/recovery_files

msf post(windows/gather/forensics/recovery_files) > options

Module options (post/windows/gather/forensics/recovery_files):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   DRIVE    C:               yes       Drive you want to recover files from.
   FILES                     no        ID or extensions of the files to recover in a comma separated way. Let empty to enumerate deleted files.
   SESSION                   yes       The session to run this module on
   TIMEOUT  3600             yes       Search timeout. If 0 the module will go through the entire $MFT.
  
  
View the full module info with the info, or info -d command.

msf post(windows/gather/forensics/recovery_files) > set session <session_id>

msf post(windows/gather/forensics/recovery_files) > set files <1234567>,<1234567>

msf post(windows/gather/forensics/recovery_files) > set drive <new_drive_letter>

msf post(windows/gather/forensics/recovery_files) > run
```

## References

- [XPNSec Offensive Forensics](https://blog.xpnsec.com/offensive-forensics/)

- [NTFS Analysis With PowerForensics](https://www.slideshare.net/JaredAtkinson/44con-london-2015-ntfs-analysis-with-powerforensics)